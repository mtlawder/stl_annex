
<!DOCTYPE html>
<html lang="en">
  
  <head>          
    <link rel="stylesheet" href="https://unpkg.com/tabulator-tables@4.9.3/dist/css/tabulator_simple.min.css" type="text/css" />              
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"></script>
    <script type="text/javascript" src="https://unpkg.com/moment@2.27.0/moment.js"></script>
    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-2.3.0.min.css" type="text/css" />
    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-2.3.0.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@mtl_stl">
    <meta name="twitter:creator" content="@mtl_stl">
    <meta name="twitter:title" content="Following Connecting Passengers: Airline Passengers Flows">
    <!-- <meta name="twitter:image" content="http://www.stlannex.com/static/images/STL_SW_routes_under 500 miles.PNG"> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap-theme.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="<<% url_for('static', filename='styles/stlannex_style.css') %>>">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="<<% url_for('static', filename='styles/stl_pop_style.css') %>>">
    <link rel="stylesheet" type="text/css" href="<<% url_for('static', filename='styles/airline_passenger_flow.css') %>>">
    <title>Airline Passenger Flow</title> 
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"></script>
  </head>
  
  <body>>
    <div id="header-vue">
      <header-bar></header-bar>
    </div>
    <div id="menu-vue">
      <menu-bar></menu-bar>
    </div>
    <div id="airline_pass">
      <br>
      <v-app>
        <br>
        <div class="selectionContainer">
          <h2>Passenger and Route Data for St. Louis-Lambert Airport</h2>
        </div>
        <br>
        <div class="selectionContainer">
          <h3>Select a departing airport and scroll down</h3>
        </div>
        <div class="selectionContainer">
          <v-btn
            class="ma-1"
            color="blue"
            plain
            @click="showAdvanced"
          >
            Advanced Options
          </v-btn>
        </div>
        <div class="selectionContainer">
          <div class="selectionSection" style="margin-bottom: 0px;">
            <v-select
              class="ma-0"
              v-model="selectedAirport"
              :items="airportList.data"
              item-text="1"
              item-value="0"
              label="Departing Airport"
              outlined
            ></v-select>
          </div>
          <div class="selectionSection" style="margin-bottom: 0px;" v-show="advanceOptionsVisible">
            <v-select
              class="ma-0"
              v-model="selectedCarrier"
              :hint="`Unless 'All' selected, only Mainline flights included`"
              :items="carriers"
              item-text="1"
              item-value="0"
              label="Carrier"
              outlined
            ></v-select>
          </div>    
        </div>
        
        <div class="paragraphContainer">
          <div style="width:100%">
            <hr/>
          </div>
        </div>
        <div class="paragraphContainer">  
          
          <div class="paragraphSection">
            <h3>Summary Statistics for {{selectedAirport}}-->STL ({{car_dict[selectedCarrier]}}) {{invalidData}}</h3>
          </div>
        </div>
        <div class="paragraphContainer">  
          <div class="paragraphSection">
            <p>
              The USDOT collects several different types of airline and passenger information. The following charts and tables use two different data sets. The T-100 data set contains monthly statistics for all domestic commercial routes by carrier. The numbers of passengers reported in the T-100 data set are exact but only show the summary information at a route level.  The DB1B data set is a more granular look at how individual passengers get from their initial origin to their final destination. This data set is most frequently used to report on Origin and Destination (O&D) passengers between cities. The data set is a 10% sample of all airline tickets and provides information about how passengers might connect through airports to reach their final destination. Since the data set is only a sample (and only contains information about domestic flights), the total numbers for passengers on specific routes will generally be lower than the exact information provided in the T-100 data, but the data is very useful to provide information about how passengers flow through airports across the country. 
            </p>
            <p>
              T-100 data is used here to report on exact number of departures, passengers, and load factors for routes and DB1B data is used to report on passenger flows.
            </p>
          </div>  
        </div>
        <div class="selectionContainer">
          <br>
          <div class="selectionSection">
            <v-card
              class="mx-auto"
              max-width="344"
              outlined
              style="background-color: #4480bd;"
            >
              <v-list-item one-line align="center">
              <v-list-item-content>
                <v-list-item-title class="headline mb-1" style="color: #ededed ;">
                  Exact Passenger Numbers
                </v-list-item-title>
                <v-list-item-title class="headline mb-1"  style="color: #ededed ;">
                  from T-100 Data
                </v-list-item-title>
              </v-list-item-content>
            </v-card>
          </div>
          <template v-for="(val, key) in t100_data">
            <div class="selectionSection">
              <v-card
                class="mx-auto"
                max-width="344"
                outlined
                style="background-color: #1c1c1c; border: #4480bd 2pt solid;"
              >
                <v-list-item two-line align="center">
                <v-list-item-content>
                  <v-list-item-title class="headline mb-1" style="color: #ededed ; text-decoration: underline;">
                    {{key}}
                  </v-list-item-title>
                  <v-list-item-title class="headline mb-1"  style="color: #ededed ;">
                    {{displayNum(val)}}
                  </v-list-item-title>
                </v-list-item-content>
              </v-card>
            </div>
          </template>
          <br>
        </div>
        <br>
        <div class="selectionContainer" style="margin-bottom: 12px;">
          <br>
          <div class="selectionSection">
            <v-card
              class="mx-auto"
              max-width="344"
              outlined
              style="background-color: #399142"
            >
              <v-list-item one-line align="center">
              <v-list-item-content>
                <v-list-item-title class="headline mb-1" style="color: #ededed ;">
                  Approx. Passengers based
                </v-list-item-title>
                <v-list-item-title class="headline mb-1"  style="color: #ededed ;">
                  on DB1B data
                </v-list-item-title>
              </v-list-item-content>
            </v-card>
          </div>
          <div class="selectionSection">
            <v-card
              class="mx-auto"
              max-width="344"
              outlined
              style="background-color: #1c1c1c; border: #399142 2pt solid;"
            >
              <v-list-item two-line align="center">
              <v-list-item-content>
                <v-list-item-title class="headline mb-1" style="color: #ededed ; text-decoration: underline;">
                  Passengers on Route
                </v-list-item-title>
                <v-list-item-title class="headline mb-1"  style="color: #ededed ;">
                  {{displayNum(totalPassengers)}}
                </v-list-item-title>
              </v-list-item-content>
            </v-card>
          </div>
          <div class="selectionSection">
            <v-card
              class="mx-auto"
              max-width="344"
              outlined
              style="background-color: #1c1c1c; border: #399142 2pt solid;"
            >
              <v-list-item two-line align="center">
              <v-list-item-content>
                <v-list-item-title class="headline mb-1" style="color: #ededed ; text-decoration: underline;">
                  Total O&D Passengers
                </v-list-item-title>
                <v-list-item-title class="headline mb-1"  style="color: #ededed ;">
                  {{displayNum(odPassengers*10)}}
                </v-list-item-title>
              </v-list-item-content>
            </v-card>
          </div>
          <div class="selectionSection">
            <v-card
              class="mx-auto"
              max-width="344"
              outlined
              style="background-color: #1c1c1c; border: #399142 2pt solid;"
            >
              <v-list-item two-line align="center">
              <v-list-item-content>
                <v-list-item-title class="headline mb-1" style="color: #ededed ; text-decoration: underline;">
                  % of O&D on Route
                </v-list-item-title>
                <v-list-item-title class="headline mb-1"  style="color: #ededed ;">
                  {{displayNum(pctOD)}}
                </v-list-item-title>
              </v-list-item-content>
            </v-card>
          </div>
          <br>
        </div>
        <hr/>
        <div class="paragraphContainer">
          <div class="paragraphSection">
            <h3>Passenger Flows for {{selectedAirport}}-->STL</h3>
            <h5>When passengers connect via STL from {{selectedAirport}}, where do they ultimately end up? (Domestic Only)</h5>
            <p>
              Charts below use <a href="https://www.transtats.bts.gov/Tables.asp?QO_VQ=EFI&QO_anzr=Nv4yv0r%FDb4vtv0%FDn0q%FDQr56v0n6v10%FDf748rB%FD%FLQOEO%FM&QO_fu146_anzr=b4vtv0%FDn0q%FDQr56v0n6v10%FDf748rB">DB1B data</a> to show how passengers using the {{selectedAirport}}-->STL route travel from their Origin in {{selectedAirport}} to their final Destination. Many passengers that flying to St. Louis, use Lambert to connect to a different airport. The chart and table below shows to which airports are the final landing spot for these travelers. On some routes to STL, over 70% of the passengers connect to different cities. For other routes the majority of the passengers will stay in St. Louis.
            </p>
            <p>
              Due to the data set being only a 10% sample of all airline tickets, all numbers shown here are approximate, but in general do a good job showing the distribution of where travelers are headed. One additional caveat to the chart and table below; they only account for passengers that are beginning their journey in the selected airport and do not account for passengers that are coming to STL via a previous connection. For many airports (like LIT or DSM) this will have a negligible impact, but for larger hub airports (like DAL or HOU) this could skew the numbers.
            </p>
          </div>
        </div>
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-md-12">
              <div class="air-table">
                <center>
                  <div id="sankeyChartDiv" v-bind:class="{ noValidData: isNotValidData }">
                    <<%div|safe%>>
                  </div>
                </center>
              </div>
            </div>
            <div class="col-lg-4 col-md-12">
              <br>
              <div class="air-table" style="max-width:300px;max-height:600px;">
                <v-simple-table
                  v-bind:class="{ noValidData: isNotValidData }"
                  fixed-header
                  height="580px"
                >
                  <template v-slot:default>
                    <thead>
                      <tr>
                        <th class="adjustTableHead">Destination</th>
                        <th class="adjustTableHead">Passengers</th>
                      </tr>
                    </thead>
                    <tbody style="text-align: center;">
                      <tr v-for="r in connectingDetail.data">
                        <td style="text-align: left;">{{r[1]}}</td>
                        <td style="text-align: center;">{{displayNum(r[2])}}</td>
                      </tr>
                    </tbody>
                  </template>
                </v-simple-table>
              </div>
            </div>
          </div>
          <hr/>        
        </div>
        <div class="paragraphContainer">
          <div class="paragraphSection">
            <h3>Historical Route Stats</h3>
            <h5><a href="https://www.transtats.bts.gov/Tables.asp?QO_VQ=EFI&QO_anzr=Nv4yv0r%FDb4vtv0%FDn0q%FDQr56v0n6v10%FDf748rB%FD%FLQOEO%FM&QO_fu146_anzr=b4vtv0%FDn0q%FDQr56v0n6v10%FDf748rB">Uses T-100 data from USDOT (Origin & Destination data)</a></h5>
            <p>
              The charts below show the exact number of total passengers served based on the T-100 data. The pie chart showing the breakdown of which airlines flew passengers on the route shows the exact numbers from the T-100 data when showing all regional airlines. When rolling up to Mainline carriers the numbers for any carrier that contracts with Regional airlines on routes will be approximate. Regional airlines usually fly passengers from a Mainline airline ticket (like United, Delta, or American), however the T-100 data does not show not record which Mainline carrier that a regional airline is flying a specific route for, but we can approximate how many passengers/flights by a regional airline flew for a specific Mainline carrier on each route by looking at the ticket data available in the DB1B dataset. For each ticket the DB1B data shows both the regional carrier flying a route and the ticketing carrier (which is usually the Mainline carrier that the regional airline affiliates with on the route). By linking these two data set, an approximate breakdown by Mainline carrier can be accomplished for each route.
            </p>
            <p>
              The passenger numbers shown below are only for flights going from the selected airport ({{selectedAirport}}) to STL. The chart does not include passengers flying back from STL to the selected airport ({{selectedAirport}}). Passenger counts for a airport will generally report both departing and arriving passengers together unless specifically noted.
            </p>
          </div>
        </div>
        <div class="container">
          <div class="row">
            
            <div class="col-lg-8 col-md-12">
              <div class="air-table">
                <center>
                  <div id="t100ChartDiv" v-bind:class="{ noValidData: isNotValidData }">
                    <<%div_t100|safe%>>
                  </div>
                </center>
              </div>
            </div>
            <div class="col-lg-4 col-md-12">
              <div v-bind:class="{ noValidData: isNotValidData }">
                <v-btn-toggle v-model="regMainSelect">
                  <v-btn  value="main">
                    Rollup to Mainline
                  </v-btn>
                  <v-btn value="regional">
                    Include Regionals
                  </v-btn>
                </v-btn-toggle>
              </div>
              <div id="carrierPieChartDiv" v-bind:class="{ noValidData: isNotValidData }">
                <<%div_pie|safe%>>
              </div>
            
            </div>
          </div>
        </div>
      </v-app>          
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
      
    <<%script|safe%>>
    <<%script_t100|safe%>> 
    <<%script_pie|safe%>>
  
    <script>   
      var vm = new Vue ({
        el: '#airline_pass',
        vuetify: new Vuetify(),
        data: {
          dests: 'x',
          items: ['a','b'],
          selectedAirport: '<<%airport|safe%>>',
          connectingDetail: [],
          airportList: <<%airport_list|safe%>>,
          totalPassengers: 0,
          odPassengers: 0,
          routePassengerEnd: 0,
          t100_data: [],
          regMainSelect: 'main',
          advanceOptionsVisible: false,
          carriers: [['ALL','All Airlines'],['WN','WN - Southwest'],['AA','AA - American'],['DL','DL - Delta'],['UA','UA - United'],
            ['AS','AS - Alaska'],['SY','SY - Sun Country'],['F9','F9 - Frontier']],
          car_dict:  {'ALL':'All Airlines','WN':'WN - Southwest','AA':'AA - American','DL':'DL - Delta','UA':'UA - United',
            'AS':'AS - Alaska','SY':'SY - Sun Country','F9':'F9 - Frontier'},
          selectedCarrier: 'ALL',
          invalidData: '',
        },
        mounted: function changeColors(){
          this.chooseAir();
        },
        computed: {
          isNotValidData: function() {
            if (this.invalidData==''){
              return false
            }
            else{
              return true
            }
          },
          pctOD: function() {
            return this.routePassengerEnd/(this.odPassengers*10)
          }
        },
        watch:{
          selectedCarrier: function(){
            this.chooseAir();
          },
          selectedAirport: function(){
            // console.log('dif air')
            this.chooseAir();
          },
          regMainSelect: function(){
            var req = new XMLHttpRequest()
            req.open("POST",'/api/passenger_flow_pie_carrier_only' ,true);
            var formData = new FormData();
            formData.append('airport', this.selectedAirport);
            formData.append('reg_main_select', this.regMainSelect);
            formData.append('carrier_select', this.selectedCarrier);
            formData.append('advanced',this.advanceOptionsVisible)
            req.send(formData)
            req.onload=function(){
              var data=JSON.parse(this.response)
              var element = document.getElementById('carrierPieChartDiv');
              element.innerHTML=data.div_pie
              eval(data.script_pie.slice(33,-9))
            }
          }
        },
        methods: {
          chooseAir() {
            // console.log('in choose)')
            // let form = document.createElement('form');
            // form.action = 'airline_passenger_flow';
            // form.method = 'POST';
            // form.innerHTML = '<input class="hidden_submit" name="airport" value="'+vm.selectedAirport+'">';
            // document.body.append(form);
            // form.submit();

            var req = new XMLHttpRequest()
            req.open("POST",'/api/passenger_flow' ,true);
            var formData = new FormData();
            formData.append('airport', this.selectedAirport);
            formData.append('reg_main_select', this.regMainSelect);
            formData.append('carrier_select', this.selectedCarrier);
            formData.append('advanced',this.advanceOptionsVisible)
            req.send(formData)
            req.onload=function(){
              console.log(this.response)
              var data=JSON.parse(this.response)
              if (data.valid_data==1){
                vm.invalidData=''
                var element = document.getElementById('sankeyChartDiv');
                element.innerHTML=data.sankeychartdiv
                eval(data.sankeychartscript.slice(33,-9))
                vm.connectingDetail=JSON.parse(data.table_data)
                vm.totalPassengers=data.total_pass
                vm.t100_data=data.t100_data
                vm.odPassengers=data.od_pass
                vm.routePassengerEnd=data.route_pass_end
                var element = document.getElementById('t100ChartDiv');
                element.innerHTML=data.div_t100
                eval(data.script_t100.slice(33,-9))
                var element = document.getElementById('carrierPieChartDiv');
                element.innerHTML=data.div_pie
                eval(data.script_pie.slice(33,-9))
              }
              else{
                vm.invalidData='No data returned, make different selection.'
                vm.totalPassengers=data.total_pass
                vm.t100_data=data.t100_data
              }
            }
          },
          showAdvanced(){
            vm.selectedCarrier='ALL'
            vm.advanceOptionsVisible=!vm.advanceOptionsVisible
          },
          displayNum(val){
            if (typeof val != 'string'){
              if (val>1){
                return val.toLocaleString()
              }
              else{
                return parseFloat(val*100).toFixed(1)+'%'
              }
            }
            else{
              return val
            }
          }
        }
      })
    </script>      
        
    <script src="<<% url_for('static', filename='components/menu.vue') %>>">
    </script>
    <script src="<<% url_for('static', filename='components/header.vue') %>>">
    </script>
    
  </body>
</html>