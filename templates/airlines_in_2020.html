<html lang="en">
  <head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-142498774-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-142498774-1');
	</script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap-theme.min.css">
	<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/styles/stlannex_style.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/stl_pop_style.css">
    <title>STL Annex</title>
    
    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-1.4.0.min.css" type="text/css" />
    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-1.4.0.min.js"></script>
    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.4.0.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>
    <style>
    .col-xl-4{
      padding:0px !important;
    }
    .col-lg-6{
      padding:0px !important;
    }
    .col-lg-12{
      padding:0px !important;
    }
    .btn-group{
      padding:5px !important;
    }
    .container{
      padding:0px !important;
      max-width:1240px;
    }
    .yearTotalChart{
      font-size:1.3rem;
      font-weight:bold;
    }
    .displayTotalChart{
      font-size:1.15rem;
    }
  </style>
  </head>
  <body>
        <center>
        <div id="header-vue">
      <header-bar></header-bar>
    </div>
          <div id="menu-vue">
          <menu-bar></menu-bar>
        </div>
         
        <br>
        <div id="aviationVue">
          <div class="container">
            <div class="col-lg-2 col-md-1">
            </div>
            <div class="col-lg-8 col-md-10 col-sm-12">
              
              <br>

              <h3>An Unprecendented Drop</h3>
              <h4>Comparing Route Statistics from 2020 to 2019</h4>
              <br>
              <div class="row">
                
                <div class="col-sm-3 col-xs-6">
                  Go to: 
                </div>
                <div class="col-sm-3 col-xs-6">
                  <a href="#aDashboard">Dashboard</a> 
                </div>
                <div class="col-sm-3 col-xs-6">
                  <a href="#commentary">Commentary</a> 
                </div>
                <div class="col-sm-3 col-xs-6">
                  <a href="#aboutAnalysis">Methodology</a> 
                </div>

              </div>
              <hr/>
              <div class="blog-container left-group">
                <p>
                  People stopped flying. That's not completely true. There are still a few people flying and that number continues to grow each week. Based on numbers reported by the TSA at the end of May, they are screening close to 15(20)% the number of passengers at US airports compared with the same time from 2019. That sounds like a terribly low number (and it is), but it's way up from around only 5% in Mid-April. Every Airport, every Airline, every Route is down in travelers which has helped to limit the COVID-19 pandemic that has caused this enormous drop. But not every Airport, every Airline, and every Route have dropped quiet the same amount. Below you can dig into the individual Airport and Route domestic statistics for the top 100 US airports based on passengers served in 2019 and see just how far each have fallen and hopefully as months continue see them rise from the lowest depths. The data below uses T-100 data from the Bureau of Transportation Statistics which is reported with a 3 month lag. I'll be updating each month as new data becomes available.
                </p>
              </div>
            <hr id="aDashboard"/>

            </div>
            <div class="col-lg-2 col-md-1">
            </div>
          </div>
          <div  class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-10 col-sm-12">
              <div >
                <h4>{{airport_sel}}</h4>
                Choose a Different Airport:
                <select v-model="airport_sel" class="btn dropdown-toggle" style="width:300px; margin-left:8px; margin-right:8px;">
                  <option class="dropdown-item" v-for="a in airport_list.data" :value=a[0]>{{a[0]}}-{{a[1]}}</option>
                </select>
                <button class="btn btn-primary" v-on:click="chooseAirport()">Update Statistics</button>
                <hr/>
                <table class="table air-table">
                  <thead style="text-align: center;">
                    <tr>
                      <th v-for="colhead in totals_display.columns" class="yearTotalChart">{{colhead}}</th>
                      
                    </tr>
                  </thead>
                  <tbody id="totalTable" style="text-align: center;">
                    <tr v-for="row in totals_display.data">
                      <td class="yearTotalChart">{{displayNum(row[0])}}</td>
                      <td v-for="d in row.slice(1)" class="displayTotalChart">{{displayNum(d)}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="col-md-1">
            </div>
          </div>
          <div class="row">
            <div class="col-lg-6 col-md-12">
              <<%seats_div|safe%>>
            </div>
            <div class="col-lg-6 col-md-12">
              <<%pass_div|safe%>>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-6 col-md-12">
              <<%dept_div|safe%>>
            </div>
            <div class="col-lg-6 col-md-12">
              <<%canc_div|safe%>>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="btn-group" role="group">
                  <button class="btn" v-on:click="route_metric_sel='Passengers'" v-bind:class="{active: route_metric_sel==='Passengers'}">Passengers Flown</button>
                  <button class="btn" v-on:click="route_metric_sel='Available Seats'" v-bind:class="{active: route_metric_sel==='Available Seats'}">Seat Capacity</button>
                  <button class="btn" v-on:click="route_metric_sel='Flights'" v-bind:class="{active: route_metric_sel==='Flights'}">Flights Completed</button>
                </div>
              <table class="table">
                <thead style="text-align: center;">
                  <tr>
                    <th></th>
                    <th colspan="3">Last Month {{route_metric_sel}}</th>
                    <th colspan="3">Year to Date {{route_metric_sel}}</th>
                    
                  </tr>
                  <tr>
                    <th>Destination Airport</th>
                    <th>2019</th>
                    <th>2020</th>
                    <th>% Change</th>
                    <th>2019</th>
                    <th>2020</th>
                    <th>% Change</th>
                  </tr>
                </thead>
                <tbody style="text-align: center;">
                  <tr v-for="(row, index) in routes_display.data" v-show="index<routeDisplay">
                    <td>{{row[13]}} ({{row[0]}})</td>
                    <template v-if="route_metric_sel=='Passengers'">
                      <td>{{displayNum(row[7])}}</td>
                      <td >{{displayNum(row[8])}}</td>
                      <td class="colorCellValue">{{pctChange(row[7],row[8])}}</td>
                      <td>{{displayNum(row[1])}}</td>
                      <td>{{displayNum(row[2])}}</td>
                      <td class="colorCellValue">{{pctChange(row[1],row[2])}}</td>
                    </template>
                    <template v-if="route_metric_sel=='Available Seats'">
                      <td>{{displayNum(row[9])}}</td>
                      <td>{{displayNum(row[10])}}</td>
                      <td class="colorCellValue">{{pctChange(row[9],row[10])}}</td>
                      <td>{{displayNum(row[3])}}</td>
                      <td>{{displayNum(row[4])}}</td>
                      <td class="colorCellValue">{{pctChange(row[3],row[4])}}</td>
                    </template>
                    <template v-if="route_metric_sel=='Flights'">
                      <td>{{displayNum(row[11])}}</td>
                      <td>{{displayNum(row[12])}}</td>
                      <td class="colorCellValue">{{pctChange(row[11],row[12])}}</td>
                      <td>{{displayNum(row[5])}}</td>
                      <td>{{displayNum(row[6])}}</td>
                      <td class="colorCellValue">{{pctChange(row[5],row[6])}}</td>
                    </template>
                    <!-- <td v-for="d in row">{{displayNum(d)}}</td> -->
                  </tr>
                </tbody>
              </table>
              <button class="btn secondary-btn" v-on:click="routeDisplay+=30">Show More Routes</button>
            </div>
          </div>
              <br/>
              Lots
              <br/>
              Lots
              <br/>
              Lots
              <br/>
              Lots
              <br/>
              Lots
              <br/>
              Lots
              <br/>
              Lots
              <br/>
            </div>

            <hr/>
          </div>
          <div class="col-lg-2 col-md-1">
            </div>
            <div class="col-lg-8 col-md-10 col-sm-12">
            <div class="blog-container left-group">

              <div id="commentary">
              My new section
              <br/>
              Lots
              <br/>
              Lots
              <br/>
              </div>  
              <hr/>
              <div id="aboutAnalysis">
                <h3>Methodology</h3>
                <p>
                  All data from the above statistics comes from the <a href="https://www.transtats.bts.gov/Tables.asp?DB_ID=110&DB_Name=Air%20Carrier%20Statistics%20%28Form%2041%20Traffic%29-%20%20U.S.%20Carriers&DB_Short_Name=Air%20Carriers">Bureau of Transportation Statistics T-100 Domestic Segment (U.S. Carriers) data set</a>. The data is reported for all domestic flight segments, so no International flight passengers are included. However, if a person has an itinerary with a domestic and international segment, the international segment is not included, but the domestic section would be included. For example, if I was flying from STL (St. Louis) to EWR (Newark) and then on to LHR (London), my flight from STL to EWR would be shown in the data, but my flight from EWR to LHR would not. This data is released publicly with a three month delay, so in early June, all of the data for March will be released.
                </p>
                <p>
                  The we aggregate the data to the Year-Month-Origin-Destination level and combined both departing and arriving statistics. This means that if you fly a round-trip from STL-ORD. You will be counted as a passenger for Lambert both when you depart and when you arrive and the round trip will count as two flights completed in the data above. The columns from the raw data used for the calculation are:
                  PUT CHART HERE
                </p>
                </p>
              </div>
              <hr/>
            </div>
          </div>
          <div class="col-lg-2 col-md-1">
          </div>
  </div>
</div>


    <<%seats_script|safe%>>
    <<%pass_script|safe%>>
    <<%dept_script|safe%>>
    <<%canc_script|safe%>>
    <script>   
      new Vue ({
        el: '#aviationVue',
        data: {
          dests: 'x',
          chart_sel: 'full',
          route_metric_sel: 'Passengers',
          routeDisplay: 10,
          airport_sel: '<<%air_sel|safe%>>',
          totals_display: <<%totals_display|safe%>>,
          airport_list: <<%airport_list|safe%>>,
          routes_display:<<%routes_display|safe%>>
          
        },
        mounted: function changeColors(){
            this.formatTotalTable();
            this.changeColorsMethod();
          }
        ,
        methods:{
          formatTotalTable(){
            var totTab=document.getElementById('totalTable')
            var trs=totTab.getElementsByTagName('tr')
            var tds=[].slice.call(trs[2].getElementsByTagName('td'),1)
            tds.forEach(function(cell){
              var cellValue=parseFloat(cell.innerText.slice(0,cell.innerText.length-1))
              var cellValueAbs=Math.abs(cellValue)/80
              if(cellValue<0){
                cell.style.backgroundColor='rgba(168, 50, 50, '+(cellValueAbs+0.2)+')'
              }
              else{
                cell.style.backgroundColor='rgba(50, 168, 81, '+(cellValueAbs+0.2)+')'
              }
            })
          },
          changeColorsMethod(){
            var cells=[].slice.call(document.getElementsByClassName('colorCellValue'),0)
            console.log(cells)
            cells.forEach(function(cell){
              var cellValue=parseFloat(cell.innerText.slice(0,cell.innerText.length-1))
              var cellValueAbs=Math.abs(cellValue)/80
              if(cellValue<0){
                cell.style.backgroundColor='rgba(168, 50, 50, '+(cellValueAbs+0.2)+')'
              }
              else{
                cell.style.backgroundColor='rgba(50, 168, 81, '+(cellValueAbs+0.2)+')'
              }
            })
            console.log(cells)
          },
          displayNum(val){
            if (typeof val != 'string'){
              if (val>1){
                return val.toLocaleString()
              }
              else{
                return parseFloat(val*100).toFixed(1)+'%'
              }
            }
            else{
              return val
            }
          },
          pctChange(start,end){
            return parseFloat((end-start)/start*100).toFixed(1)+'%'

          },
          chooseAirport(){
            let form = document.createElement('form');
            form.action = 'airlines_in_2020';
            form.method = 'POST';
            form.innerHTML = '<input class="hidden_submit" name="airport" value="'+this.airport_sel+'">';
            document.body.append(form);
            form.submit();
          }
        }
      })
      </script>
        
</center>

	<script src="static/components/menu.vue">
    </script>
    <script src="static/components/header.vue">
    </script>


  </body>
</html>